{
  "category": "deserialization",
  "patterns": [
    {
      "id": "deser-001",
      "name": "YAML unsafe load (Python)",
      "description": "yaml.load() without Loader parameter can execute arbitrary code",
      "severity": "CRITICAL",
      "match": {
        "type": "regex",
        "value": "yaml\\.load\\([^,)]+\\)|yaml\\.load\\([^)]*,\\s*Loader\\s*=\\s*yaml\\.Loader\\s*\\)",
        "flags": ""
      },
      "layer": "code",
      "category": "deserialization",
      "remediation": {
        "title": "Use yaml.safe_load()",
        "suggestions": [
          "Use yaml.safe_load() instead of yaml.load()",
          "If Loader is needed, use yaml.SafeLoader",
          "yaml.load() can execute arbitrary Python code in YAML",
          "Example: yaml.safe_load(data) or yaml.load(data, Loader=yaml.SafeLoader)"
        ]
      }
    },
    {
      "id": "deser-002",
      "name": "XML parsing without entity protection (Python)",
      "description": "XML parsing without defusedxml can be vulnerable to XXE and billion laughs attacks",
      "severity": "HIGH",
      "match": {
        "type": "regex",
        "value": "from xml\\.etree|import xml\\.etree|ElementTree\\.parse|lxml\\.etree",
        "flags": ""
      },
      "layer": "code",
      "category": "deserialization",
      "remediation": {
        "title": "Use defusedxml library",
        "suggestions": [
          "Use defusedxml library instead of xml.etree or lxml",
          "Install: pip install defusedxml",
          "from defusedxml.ElementTree import parse",
          "Protects against XXE, billion laughs, and other XML attacks",
          "Configure parsers to disable external entities"
        ]
      }
    },
    {
      "id": "deser-003",
      "name": "marshal.loads() usage (Python)",
      "description": "marshal module is not safe for untrusted data",
      "severity": "HIGH",
      "match": {
        "type": "regex",
        "value": "marshal\\.loads?\\(",
        "flags": ""
      },
      "layer": "code",
      "category": "deserialization",
      "remediation": {
        "title": "Use json or safer serialization",
        "suggestions": [
          "Use json module for data serialization",
          "marshal is only safe for trusted data",
          "Never deserialize marshal data from untrusted sources",
          "Consider using json, msgpack, or protobuf for untrusted data"
        ]
      }
    },
    {
      "id": "deser-004",
      "name": "jsonpickle decode (Python)",
      "description": "jsonpickle can deserialize arbitrary Python objects",
      "severity": "HIGH",
      "match": {
        "type": "regex",
        "value": "jsonpickle\\.(decode|loads)",
        "flags": ""
      },
      "layer": "code",
      "category": "deserialization",
      "remediation": {
        "title": "Use standard json module",
        "suggestions": [
          "Use json.loads() for untrusted data",
          "jsonpickle can instantiate arbitrary classes",
          "Only use jsonpickle with data you control",
          "Implement class whitelisting if jsonpickle is required"
        ]
      }
    }
  ]
}
