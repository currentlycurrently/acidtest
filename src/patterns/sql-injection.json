{
  "category": "sql-injection",
  "patterns": [
    {
      "id": "sql-001",
      "name": "SQL query with string concatenation",
      "description": "SQL query constructed using string concatenation, vulnerable to SQL injection",
      "severity": "CRITICAL",
      "match": {
        "type": "regex",
        "value": "(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER).*\\+.*['\"`]",
        "flags": "i"
      },
      "layer": "code",
      "category": "sql-injection",
      "remediation": {
        "title": "Use parameterized queries",
        "suggestions": [
          "Use prepared statements or parameterized queries instead of string concatenation",
          "For TypeScript: Use libraries like pg, mysql2, or an ORM like Prisma/TypeORM",
          "For Python: Use parameterized queries with psycopg2, mysql-connector, or SQLAlchemy",
          "Never concatenate user input directly into SQL queries"
        ]
      }
    },
    {
      "id": "sql-002",
      "name": "SQL query with template literal",
      "description": "SQL query using template literals, potentially vulnerable to SQL injection",
      "severity": "HIGH",
      "match": {
        "type": "regex",
        "value": "`(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER).*\\$\\{",
        "flags": "i"
      },
      "layer": "code",
      "category": "sql-injection",
      "remediation": {
        "title": "Use parameterized queries",
        "suggestions": [
          "Avoid template literals for SQL queries",
          "Use parameterized queries with placeholders ($1, $2, etc.)",
          "Use an ORM or query builder that handles escaping automatically"
        ]
      }
    },
    {
      "id": "sql-003",
      "name": "SQL query with string formatting (Python)",
      "description": "SQL query using Python string formatting (.format() or f-strings), vulnerable to SQL injection",
      "severity": "CRITICAL",
      "match": {
        "type": "regex",
        "value": "(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER).*(\\.format\\(|f['\"])",
        "flags": "i"
      },
      "layer": "code",
      "category": "sql-injection",
      "remediation": {
        "title": "Use parameterized queries",
        "suggestions": [
          "Use parameterized queries with %s placeholders",
          "For psycopg2: cursor.execute('SELECT * FROM users WHERE id = %s', (user_id,))",
          "For SQLAlchemy: Use ORM or text() with bindparams",
          "Never use f-strings or .format() for SQL queries"
        ]
      }
    },
    {
      "id": "sql-004",
      "name": "Database execute with formatting",
      "description": "Direct execution of formatted SQL query",
      "severity": "CRITICAL",
      "match": {
        "type": "regex",
        "value": "(execute|query|raw)\\([^)]*\\.(format|replace)\\(",
        "flags": "i"
      },
      "layer": "code",
      "category": "sql-injection",
      "remediation": {
        "title": "Use parameterized queries",
        "suggestions": [
          "Pass parameters separately to execute() method",
          "Use the database library's parameter binding features",
          "Never format strings before passing to execute()"
        ]
      }
    }
  ]
}
